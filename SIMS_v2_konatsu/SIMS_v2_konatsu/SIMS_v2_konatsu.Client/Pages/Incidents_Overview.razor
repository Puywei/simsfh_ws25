@page "/incidents_overview"



<PageTitle>Incidents Overview</PageTitle>

<MudText Typo="Typo.h3" GutterBottom="true">Incidents Overview</MudText>
<MudText Typo="Typo.body1" Class="mb-8">Security Incidents</MudText>


<NavLink href="/New_Ticket"><MudButton Variant="Variant.Filled" DropShadow="false" Color="Color.Primary">Create new Ticket</MudButton></NavLink>

<MudIconButton Icon="@Icons.Material.Filled.Delete" Variant="Variant.Filled" Color="Color.Primary" Size="Size.Medium" />

@if (incidents == null)
{
    <MudProgressCircular Color="Color.Default" Indeterminate="true" />
}
else
{
    <MudTable Items="incidents" Hover="true" SortLabel="Sort By" Elevation="0" AllowUnsorted="false">
        <HeaderContent>
            <MudTh></MudTh>
            <MudTh><MudTableSortLabel InitialDirection="SortDirection.Ascending" SortBy="new Func<IncidentsOverview, object>(x => x.Key)">Key</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<IncidentsOverview, object>(x => x.Summary)">Summary</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<IncidentsOverview, object>(x => x.Author)">Author</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<IncidentsOverview, object>(x => x.AssignedPerson!)">Assigned Person</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<IncidentsOverview, object>(x => x.Status)">Status</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<IncidentsOverview, object>(x => x.CreatedDate)">created Date</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<IncidentsOverview, object>(x => x.TimeToResolution)">Time to Resolution</MudTableSortLabel></MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Enabled"><MudCheckBox T="bool" Checked="@context.selected" ValueChanged="@(e => UpdateRecord(context, e))"></MudCheckBox></MudTd>
            <MudTd DataLabel="Key"><MudLink Href="#">@context.Key</MudLink></MudTd>
            <MudTd DataLabel="summary">@context.Summary</MudTd>
            <MudTd DataLabel="author">@context.Author</MudTd>
            <MudTd DataLabel="assigned_person">@context.AssignedPerson</MudTd>
            <MudTd DataLabel="assigned_person">@context.Status</MudTd>
            <MudTd DataLabel="assigned_person">@context.CreatedDate</MudTd>
            <MudTd DataLabel="assigned_person">@context.TimeToResolution</MudTd>
        </RowTemplate>
        <PagerContent>
            <MudTablePager PageSizeOptions="new int[] { 50, 100 }" />
        </PagerContent>
    </MudTable>

}

@code {
    public bool Basic_CheckBox1 { get; set; } = true;
    private IncidentsOverview[]? incidents;

    protected override async Task OnInitializedAsync()
    {
        // Simulate asynchronous loading to demonstrate a loading indicator
        //await Task.Delay(500);

        //values from database
        incidents = new IncidentsOverview[2];
        incidents[0] = new IncidentsOverview();
        incidents[0].Key = "INC01";
        incidents[0].Summary = "Our first incident";
        incidents[0].Author = "Konatsu";
        incidents[0].AssignedPerson = "Marco";
        incidents[0].Status = "Open";
        incidents[0].CreatedDate = DateOnly.FromDateTime(DateTime.Now);
        incidents[0].TimeToResolution = DateOnly.FromDateTime(DateTime.Now).AddDays(5);

        incidents[1] = new IncidentsOverview();
        incidents[1].Key = "INC02";
        incidents[1].Summary = "Our second incident";
        incidents[1].Author = "Marco";
        incidents[1].AssignedPerson = "Konatsu";
        incidents[1].Status = "closed";
        incidents[1].CreatedDate = DateOnly.FromDateTime(DateTime.Now).AddDays(-5);
        incidents[1].TimeToResolution = DateOnly.FromDateTime(DateTime.Now).AddDays(-3);

        /*
        string csvFile = await HttpClient.GetStringAsync("data2.csv");
        var reader = new StreamReader("data2.csv", true);
        var csv = new CsvReader(reader, CultureInfo.InvariantCulture);
        var records = csv.GetRecords<IncidentsOverview>();
        incidents = records.ToArray();
        //reader.Close();
        */

    }

    private async Task UpdateRecord(IncidentsOverview record, bool ischecked)
    {
        record.selected = ischecked;

    }

    private class IncidentsOverview
    {
        public string Key { get; set; }
        public string Summary { get; set; }
        public string Author { get; set; }
        public string? AssignedPerson { get; set; }
        public string? Status { get; set; }
        public DateOnly CreatedDate { get; set; }
        public DateOnly TimeToResolution { get; set; }
        public bool selected { get; set; }
    }
}

<MudLink Href="/INC01">Default</MudLink>
