@page "/incidents_overview"
@using RestSharp; 
@using System.Text.Json; 
@using sims_web_app.Data.Model



<PageTitle>Incidents Overview</PageTitle>

<MudText Typo="Typo.h3" GutterBottom="true">Incidents Overview</MudText>
<MudText Typo="Typo.body1" Class="mb-8">Security Incidents</MudText>


<NavLink href="/New_Ticket"><MudButton Variant="Variant.Filled" DropShadow="false" Color="Color.Primary">Create new Ticket</MudButton></NavLink>

<MudIconButton Icon="@Icons.Material.Filled.Delete" Variant="Variant.Filled" Color="Color.Primary" Size="Size.Medium" />

@if (incidents == null)
{
    <MudProgressCircular Color="Color.Default" Indeterminate="true" />
}
else
{
    <MudTable Items="incidents" Hover="true" SortLabel="Sort By" Elevation="0" AllowUnsorted="false">
        <HeaderContent>
            <MudTh></MudTh>
            <MudTh><MudTableSortLabel InitialDirection="SortDirection.Ascending" SortBy="new Func<IncidentsOverview, object>(x => x.Id)">Incident ID</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<IncidentsOverview, object>(x => x.Summary)">Subject</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<IncidentsOverview, object>(x => x.Severity)">Severity</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<IncidentsOverview, object>(x => x.AssignedPerson!)">Assigned Person</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<IncidentsOverview, object>(x => x.Status)">Status</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<IncidentsOverview, object>(x => x.CreateDate)">created Date</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<IncidentsOverview, object>(x => x.Id)">Time to Resolution</MudTableSortLabel></MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Enabled"><MudCheckBox T="bool" Checked="@context.selected" ValueChanged="@(e => UpdateRecord(context, e))"></MudCheckBox></MudTd>
            <MudTd DataLabel="Key"><MudLink Href="/INC">@context.Id</MudLink></MudTd>
            <MudTd DataLabel="summary">@context.Summary</MudTd>
            <MudTd DataLabel="author">@context.Severity</MudTd>
            <MudTd DataLabel="assigned_person">@context.AssignedPerson</MudTd>
            <MudTd DataLabel="assigned_person">@context.Status</MudTd>
            <MudTd DataLabel="assigned_person">@context.CreateDate</MudTd>
            <MudTd DataLabel="assigned_person">@context.Id</MudTd>
        </RowTemplate>
        <PagerContent>
            <MudTablePager PageSizeOptions="new int[] { 50, 100 }" />
        </PagerContent>
    </MudTable>

}



@code {

    public bool Basic_CheckBox1 { get; set; } = true;
    private IncidentsOverview[]? incidents;

    private const string ApiBaseUrl = "hier URL";
    private const string IncidentsEndpoint = "/api/incidents  Path?????";


    protected override async Task OnInitializedAsync()
    {
        /*
        try
        {
        // 1. Create RestClient
            var options = new RestClientOptions(ApiBaseUrl);
            var client = new RestClient(options);

        // 2. Create GET request
            var request = new RestRequest(IncidentsEndpoint, Method.Get);

            // If your API needs auth, add headers here:
            // request.AddHeader("Authorization", "Bearer YOUR_TOKEN_HERE");

        // 3. Execute the request
            var response = await client.ExecuteAsync(request);

        if (!response.IsSuccessful || string.IsNullOrWhiteSpace(response.Content))
            {
                Console.Error.WriteLine($"Failed to load incidents. Status: {response.StatusCode}, Error: {response.ErrorMessage}");
                incidents = new List<IncidentsOverview>();
                return;
            }




        }
        */

        

        


    }

    private async Task UpdateRecord(IncidentsOverview record, bool ischecked)
    {
        record.selected = ischecked;

    }

    
}


