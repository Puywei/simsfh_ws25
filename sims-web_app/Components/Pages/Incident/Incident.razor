@page "/Incident/{Id}"
@attribute [Authorize]
@using Microsoft.AspNetCore.Authorization
@using sims_web_app.Components.Identity.Contracts
@using sims_web_app.Components.Identity.Services
@using sims_web_app.Services

<PageTitle>INC</PageTitle>

@if (!isDone)
{
    <h1>Loading data...</h1>
}
else
{

<MudCard Style="max-width: 800px; margin: 20px auto;">
    <MudCardHeader>
        <CardHeaderContent>
            <MudText Typo="Typo.h5">Incident Details</MudText>
        </CardHeaderContent>
    </MudCardHeader>
    <MudCardContent>
        <MudGrid Spacing="3">
            <MudItem xs="12" sm="6">
                <MudField Label="Severity" Variant="Variant.Outlined" InnerPadding="false">
                    <MudRadioGroup T="sims_web_app.Data.Model.Enum.IncidentSeverity?" @bind-Value="_incident.Severity">
                        <MudRadio T="sims_web_app.Data.Model.Enum.IncidentSeverity?" Value="sims_web_app.Data.Model.Enum.IncidentSeverity.Low">low</MudRadio>
                        <MudRadio T="sims_web_app.Data.Model.Enum.IncidentSeverity?" Value="sims_web_app.Data.Model.Enum.IncidentSeverity.Medium">medium</MudRadio>
                        <MudRadio T="sims_web_app.Data.Model.Enum.IncidentSeverity?" Value="sims_web_app.Data.Model.Enum.IncidentSeverity.High">high</MudRadio>
                        <MudRadio T="sims_web_app.Data.Model.Enum.IncidentSeverity?" Value="sims_web_app.Data.Model.Enum.IncidentSeverity.Critical">critical</MudRadio>
                    </MudRadioGroup>
                </MudField>
            </MudItem>
            <MudItem xs="12">
                <MudField Label="Status" Variant="Variant.Outlined" InnerPadding="false">
                    <MudRadioGroup T="sims_web_app.Data.Model.Enum.IncidentStatus?" @bind-Value="_incident.Status">
                        <MudRadio T="sims_web_app.Data.Model.Enum.IncidentStatus?" Value="sims_web_app.Data.Model.Enum.IncidentStatus.Open">open</MudRadio>
                        <MudRadio T="sims_web_app.Data.Model.Enum.IncidentStatus?" Value="sims_web_app.Data.Model.Enum.IncidentStatus.onProgress">assigned</MudRadio>
                        <MudRadio T="sims_web_app.Data.Model.Enum.IncidentStatus?" Value="sims_web_app.Data.Model.Enum.IncidentStatus.onHold">on hold</MudRadio>
                        <MudRadio T="sims_web_app.Data.Model.Enum.IncidentStatus?" Value="sims_web_app.Data.Model.Enum.IncidentStatus.Solved">solved</MudRadio>
                        <MudRadio T="sims_web_app.Data.Model.Enum.IncidentStatus?" Value="sims_web_app.Data.Model.Enum.IncidentStatus.Aborted">solved</MudRadio>
                    </MudRadioGroup>
                </MudField>
            </MudItem>

            <MudItem xs="12">
                <MudDivider />
            </MudItem>
            <MudItem xs="12">
                <MudSelect T="string" @bind-Value="_incident.AssignedPerson" Label="Assigned Person" FullWidth="true" Variant="Variant.Outlined" Clearable>
                    <MudSelectItem Value='"John Doe"'>John Doe</MudSelectItem>
                    <MudSelectItem Value='"Jane Smith"'>Jane Smith</MudSelectItem>
                </MudSelect>
            </MudItem>
            
            <MudItem xs="12">
                <MudTextField T="string" Label="Description" Variant="Variant.Outlined" @bind-Value="_incident.Description" Lines="10" />
            </MudItem>
            
            <MudItem xs="12" sm="6">
                @* ReadOnly wird beibehalten, da das Erstellungsdatum üblicherweise fix ist *@
                <MudDatePicker Label="Ticket created" @bind-Date="_incident.CreateDate" ReadOnly="true" />
            </MudItem>
        </MudGrid>
    </MudCardContent>
    <MudCardActions Class="d-flex justify-end">
        <MudButton Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Save" Color="Color.Info" Size="Size.Medium">Save</MudButton>
        <MudIconButton Icon="@Icons.Material.Filled.Delete" Variant="Variant.Filled" Color="Color.Error" Size="Size.Medium" />
    </MudCardActions>
</MudCard>

}

@code
{
    [Parameter]
    public string Id { get; set; }

    private bool isDone = false;

    private Data.Model.Incident? _incident;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            _incident = await BackendApiHandler.GetIncidentById(Id);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading customer: {ex.Message}");
        }

        this.isDone = true;
    }
}