@page "/logoverview"
@attribute [Authorize(Roles = "Admin")]
@using Microsoft.AspNetCore.Authorization
@using sims_web_app.Data.Model
@using sims_web_app.Services
@inject LogApiHandler LogApiHandler

<PageTitle>Log Overview</PageTitle>

<MudPaper Class="pa-4" Elevation="3">
    <MudText Typo="Typo.h5" Class="mb-4">Log Overview</MudText>
@if (!isDone)
{
    <MudProgressCircular Color="Color.Primary" Size="Size.Large" Indeterminate="true" />
    <MudText Typo="Typo.body1">Daten werden geladen...</MudText>
}
    else
    {
        <MudDataGrid Items="logs">
            <ToolBarContent>
            </ToolBarContent>
            <Columns>
                <PropertyColumn Property="l => l.LogId" Title="Log Id"/>
                <PropertyColumn Property="l => l.Timestamp" Title="Timestamp"/>
                <PropertyColumn Property="l => l.Message" Title="Message"/>
                <PropertyColumn Property="l => l.Severity" Title="Severity"/>
            </Columns>
            <PagerContent>
                <MudDataGridPager/>
            </PagerContent>
        </MudDataGrid>
    }
    
</MudPaper>

@code {
    private List<LogEntry> logs = new();
    bool isDone = false;


    protected override async Task OnInitializedAsync()
    {
        await LoadLogsAsync();
        isDone = true;
    }

    private async Task LoadLogsAsync()
    {
        try
        {
            logs = await LogApiHandler.GetAllLogs();
            
            await InvokeAsync(StateHasChanged);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Fehler beim Laden der Logs: {ex.Message}");
        }
    }

}
